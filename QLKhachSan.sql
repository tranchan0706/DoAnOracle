---------------------------------------CREATE TABLE
CREATE TABLE KHACHHANG 
(
  MAKH VARCHAR2(11 BYTE) NOT NULL 
, TENKH VARCHAR2(50 BYTE) NOT NULL 
, NGAYSINH DATE 
, GIOITINH VARCHAR2(3 BYTE) 
, CMND VARCHAR2(20 BYTE) 
, QUOCTICH VARCHAR2(50 BYTE) 
, SDT VARCHAR2(20 BYTE) 
, LOAIKH VARCHAR2(20 BYTE) 
, CONSTRAINT PK_KHACHHANG PRIMARY KEY 
  (
    MAKH 
  )
  ENABLE 
);
----------------------------------
CREATE TABLE PHONG 
(
  SOPHONG VARCHAR2(11 BYTE) NOT NULL 
, LOAIPHONG VARCHAR2(20 BYTE) NOT NULL 
, GIAPHONG NUMBER CHECK (GIAPHONG >=0)
, TINHTRANG VARCHAR2(50 BYTE) 
, CONSTRAINT PK_PHONG PRIMARY KEY 
  (
    SOPHONG 
  )
  ENABLE 
);
-----------------------------------
CREATE TABLE NHANVIEN 
(
  MANV VARCHAR2(20 BYTE) NOT NULL 
, TENNV VARCHAR2(50 BYTE) NOT NULL 
, CHUCVU VARCHAR2(50 BYTE) 
, LUONGNV NUMBER CHECK (LUONGNV>=0)
, NGAYSINH DATE 
, GIOITINH VARCHAR2(3 BYTE) CHECK(GIOITINH='NAM' OR GIOITINH='NU')
, MANQL VARCHAR2(11 BYTE) 
, ANHNV VARCHAR2(20 BYTE) 
, CONSTRAINT PK_NHANVIEN PRIMARY KEY 
  (
    MANV 
  )
  ENABLE 
);
-------------------------------------
CREATE TABLE DICHVU 
(
  MADV VARCHAR2(11 BYTE) NOT NULL 
, TENDV VARCHAR2(50 BYTE) NOT NULL 
, GIADV NUMBER CHECK (GIADV >=0)
, NGUOIQL VARCHAR2(50 BYTE) 
, CONSTRAINT PK_DICHVU PRIMARY KEY 
  (MADV ) ENABLE ) ;
---------------------------------
CREATE TABLE HOADON 
(
  MAHD VARCHAR2(11 BYTE) NOT NULL 
, TENHD VARCHAR2(50 BYTE) 
, MADV VARCHAR2(11 BYTE) 
, MAKH VARCHAR2(11 BYTE) 
, NGAYLAP DATE 
, MANV VARCHAR2(11 BYTE) 
, SOPHONG VARCHAR2(11 BYTE)
, CONSTRAINT PK_HOADON PRIMARY KEY 
  (MAHD)ENABLE );
ALTER TABLE HOADON
ADD CONSTRAINT FK_DICHVU FOREIGN KEY
(MADV )REFERENCES DICHVU(MADV )ENABLE;
ALTER TABLE HOADON
ADD CONSTRAINT FK_PHONG FOREIGN KEY
(SOPHONG )REFERENCES PHONG(SOPHONG )ENABLE;
------------------------------------
CREATE TABLE THUEPHONG 
(
  MADK VARCHAR2(11 BYTE) NOT NULL 
, MAKH VARCHAR2(11 BYTE) 
, SOPHONG VARCHAR2(11 BYTE) 
, NGAYDK DATE 
, NGAYDI DATE 
, SONGAY NUMBER 
, CONSTRAINT PK_THUEPHONG PRIMARY KEY 
  ( MADK ) ENABLE ) ;
ALTER TABLE THUEPHONG
ADD CONSTRAINT FK_PHONG_KHACHHANG FOREIGN KEY
( MAKH )REFERENCES KHACHHANG( MAKH )ENABLE;
ALTER TABLE THUEPHONG
ADD CONSTRAINT FK_THUEPHONG_PHONG FOREIGN KEY
(SOPHONG )REFERENCES PHONG(SOPHONG )ENABLE;
------------------------
CREATE TABLE CTHOADON 
(
  MAHD VARCHAR2(11 BYTE) NOT NULL 
, MADK VARCHAR2(11 BYTE) NOT NULL 
, TONGTIEN NUMBER
, GHICHU VARCHAR2(50 BYTE) 
, CONSTRAINT CTHOADON_PK PRIMARY KEY 
  (MAHD , MADK )ENABLE );
ALTER TABLE CTHOADON
ADD CONSTRAINT CTHOADON_HOADON_FK1 FOREIGN KEY
(MAHD )REFERENCES HOADON(MAHD )ENABLE;
ALTER TABLE CTHOADON
ADD CONSTRAINT CTHOADON_THUEPHONG_FK1 FOREIGN KEY
(MADK)REFERENCES THUEPHONG(MADK )ENABLE;

--------------------------------------------------------INSERT TABLE

INSERT INTO khachhang VALUES('KH08','TRAN MINH NHAN','27-JAN-00','NAM','1240','VIET NAM','0123465788','VIP');
INSERT INTO khachhang VALUES('KH01','VU THI TUYET','21-OCT-88','NU','1234','VIET NAM','0123456781','BINH THUONG');
INSERT INTO khachhang VALUES('KH02','LE SI MINH','13-DEC-90','NAM','1233','VIET NAM','0123456782','VIP');
INSERT INTO khachhang VALUES('KH03','DO MANH TUAN','11-JAN-92	','NAM','1235','VIET NAM','0123456783	','BINH THUONG');
INSERT INTO khachhang VALUES('KH04','TRAN VAN HUNG','15-OCT-86','NAM','1236','VIET NAM','0123456784','BINH THUONG');
INSERT INTO khachhang VALUES('KH05','LE PHUONG LINH','30-DEC-95','NU','1237	','VIET NAM','0123456785','THAN THIET');
INSERT INTO khachhang VALUES('KH06','NNGUYEN PHUONG THAO','05-FEB-98','NU','1238','VIET NAM','0123456786','THAN THIET');
INSERT INTO khachhang VALUES('KH07','LE VAN HOANG','26-NOV-20','NAM','1239','VIET NAM','0123456787','BINH THUONG');

INSERT INTO phong VALUES ('P001','A',1000000,'CON TRONG');
INSERT INTO phong VALUES ('P002','B',800000,'CON TRONG');
INSERT INTO phong VALUES ('P003','A',1000000,'DA DAT');
INSERT INTO phong VALUES ('P004','C',600000,'DA DAT');
INSERT INTO phong VALUES ('P005','C',600000,'CON TRONG');
INSERT INTO phong VALUES ('P006','A',1000000,'DA DAT');
INSERT INTO phong VALUES ('P007','B',800000,'CON TRONG');
INSERT INTO phong VALUES ('P008','C',600000,'CON TRONG');
INSERT INTO phong VALUES ('P009','A',1000000,'DA DAT');
INSERT INTO phong VALUES ('P010','B',800000,'DA DAT');

INSERT INTO nhanvien VALUES ('NV001','DINH HUY TRONG','QUAN LY',3000000,'08-JUN-81','NAM','NULL','NV01.JPG');
INSERT INTO nhanvien VALUES ('NV002','DAO MANH HUY','QUAN LY','3000000','21-OCT-86','NAM','NULL','NV02.JPG');
INSERT INTO nhanvien VALUES ('NV003','LE THU HUYEN','NV MAT XOA',500000,'14-DEC-85','NU','NV001','NV03.JPG');
INSERT INTO nhanvien VALUES ('NV004','NGUYEN NGOC BICH','NV PHUC VU',600000,'02-FEB-82','NU','NV002','NV04.JPG');
INSERT INTO nhanvien VALUES ('NV005', 'PHAM THI LAN	','NV MAT XOA',800000,'24-SEP-76','NU','NV001','NV05.JPG');
INSERT INTO nhanvien VALUES ('NV006', 'TRAN XUAN DONG','NV MAT XOA',500000,'30-AUG-80','NAM','NV001','NV06.JPG');
INSERT INTO nhanvien VALUES ('NV007','LE MINH NHUT','NV PHUC VU',600000,'02-MAY-88','NAM','NV002','NV07.JPG');
INSERT INTO nhanvien VALUES ('NV008','NGUYEN THI NGAN','NV QUAY BAR',800000,'12-APR-87','NU','NV002','NV08.JPG');

INSERT INTO dichvu VALUES ('DV007','AN UONG',400000,'');
INSERT INTO dichvu VALUES ('DV001','MAT XOA',100000,'NV001');
INSERT INTO dichvu VALUES ('DV002','DU LICH	',500000,'NV001');
INSERT INTO dichvu VALUES ('DV003','TO CHUC HOI THAO',1000000	,'NV002');
INSERT INTO dichvu VALUES ('DV004','TO CHUC TIEC CUOI',1500000,'NV001');
INSERT INTO dichvu VALUES ('DV005','XONG HOI',300000,'NV002');
INSERT INTO dichvu VALUES ('DV006','MUON DO',200000,'');

INSERT INTO thuephong VALUES ('DK001','KH01','P003','11-OCT-09','21-OCT-09',10);
INSERT INTO thuephong VALUES ('DK002','KH02','P010','21-DEC-09','29-DEC-09',8);
INSERT INTO thuephong VALUES ('DK003','KH03','P003','03-NOV-09','21-NOV-09',18);
INSERT INTO thuephong VALUES ('DK004','KH04','P004','15-AUG-09','22-AUG-09',7);
INSERT INTO thuephong VALUES ('DK005','KH01','P006','13-JUL-09','15-JUL-09',2);
INSERT INTO thuephong VALUES ('DK006','KH05','P009','05-MAY-09','30-MAY-09',25);
INSERT INTO thuephong VALUES ('DK007','KH06','P004','24-JAN-09','28-JAN-09',4);
INSERT INTO thuephong VALUES ('DK008','KH07','P006','27-FEB-09','28-FEB-09',1);
INSERT INTO thuephong VALUES ('DK009','KH02','P003','07-AUG-09','15-AUG-09',8);
INSERT INTO thuephong VALUES ('DK010','KH03','P010','21-MAR-09','29-MAR-09',8);

INSERT INTO hoadon VALUES ('HD001','HDDV MAT XOA','DV001','KH01','14-OCT-09','NV003','P003');
INSERT INTO hoadon VALUES ('HD002','HDDV MUON DO','DV006','KH01','05-OCT-07','NV001','P006');
INSERT INTO hoadon VALUES ('HD003','HDDV XONG HOI','DV005','KH02','02-JUL-05','NV007','P010');
INSERT INTO hoadon VALUES ('HD004','HDDV TO CHUC HOI THAO','DV003','KH07','13-NOV-09','NV002','P006');
INSERT INTO hoadon VALUES ('HD005','HDDV TO CHUC TIEC CUOI','DV004','KH02','30-DEC-09','NV002','P003');
INSERT INTO hoadon VALUES ('HD006','HDDV MUON DO','DV006','KH03','11-FEB-08','NV004','P003');
INSERT INTO hoadon VALUES ('HD007','HDDV MAT XOA','DV001','KH06','27-DEC-08','NV005','P004');
INSERT INTO hoadon VALUES ('HD008','HDDV TO CHUC HOI THAO','DV003','KH05','	25-OCT-09','NV001','P009');
INSERT INTO hoadon VALUES ('HD009','HDDV DU LICH','DV002','KH04','15-JUL-07','NV004','P004');
INSERT INTO hoadon VALUES ('HD010','HDDV TO CHUC TIEC CUOI','DV004','KH03','18-AUG-07','NV001','P010');

INSERT INTO CTHOADON VALUES ('HD001','DK001','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD005','DK009','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD008','DK006','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD003','DK002','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD006','DK003','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD002','DK005','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD004','DK008','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD007','DK007','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD009','DK004','','CHUA THANH TOAN');
INSERT INTO CTHOADON VALUES ('HD010','DK010','','CHUA THANH TOAN');
--------------------------------------------------------TRIGGER

create or replace trigger ktra_datphong1
before insert or update of ngaydk,ngaydi on thuephong
for each row
begin
  if (:NEW.ngaydi) < (:NEW.ngaydk)
  then raise_application_error (-20202,'ngay di > ngay dang ky !!');
  end if;
end;

create or replace trigger ktra_datphong2
before insert on thuephong
for each row
declare dem number;
begin
  select count(makh) into dem
  from thuephong
  group by sophong
  order by 1 desc fetch first 1 rows only;
  if(dem>2)
  then raise_application_error (-20203,'Phong khong duoc > 3 nguoi !!');
  end if;
end;
---------------------------------------------PROCEDURE
create or replace procedure Tang_Luong
( ma nhanvien.manv%type,
  phantram number)
is
begin
  update nhanvien
  set luongnv=luongnv+(luongnv*phantram/100)
  where manv=ma;
end Tang_Luong;
--execute Tang_Luong('NV001',5);
--select text FROM user_source where name='Tang_Luong' and type='PROCEDURE' order by line;
---------------------------------------FUNCTION
create or replace function slkhachhang
return number is
sl number :=0;
begin
  select count(*) into sl
  from khachhang;
  return sl;
end;

--select slkhachhang() from dual;
--declare
--c number ;
--begin  
 -- c:= slkhachhang();
 -- dbms_output.put_line('sl khach la: '|| c);
--end;

create or replace function sum_luongnv
return number
is
  tong number;
begin
   select sum(luongnv) into tong from nhanvien;
   return tong;
end sum_luongnv;

--select sum_luongnv() from dual;
----------------------------------------DROP TABLE
DROP TABLE cthoadon;
DROP TABLE hoadon;
DROP TABLE thuephong;
DROP TABLE phong;
DROP TABLE khachhang;
DROP TABLE dichvu;
DROP TABLE nhanvien;

